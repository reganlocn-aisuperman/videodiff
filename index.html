<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoDiff Pro v1.26 - Final Layout</title>
    <style>
        :root {
            --primary: #3b82f6; --accent: #10b981;
            --bg: #0f172a; --panel: #1e293b; --text: #f8fafc; --border: #334155; --input-bg: #0f172a;
        }
        [data-theme="light"] {
            --bg: #f1f5f9; --panel: #ffffff; --text: #1e293b; --border: #cbd5e1; --input-bg: #f8fafc;
        }

        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; transition: all 0.3s ease; }
        
        /* 顶部导航 */
        .top-nav { width: 100%; max-width: 850px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-tools { display: flex; gap: 12px; align-items: center; }
        .icon-btn { background: var(--panel); border: 1px solid var(--border); color: var(--text); cursor: pointer; padding: 6px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .icon-btn svg { width: 18px; height: 18px; fill: currentColor; }

        .lang-switcher { background: var(--panel); border: 1px solid var(--border); border-radius: 6px; padding: 2px; display: flex; }
        .lang-btn { padding: 4px 8px; font-size: 11px; cursor: pointer; border-radius: 4px; border:none; background:transparent; color: var(--text); opacity: 0.5; font-weight: bold; }
        .lang-btn.active { background: var(--primary); color: white; opacity: 1; }

        /* 顶部红框区域：左右完全对齐播放器 */
        .grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 16px; 
            width: 850px; margin-bottom: 16px; box-sizing: border-box; 
        }
        .card { background: var(--panel); padding: 12px; border-radius: 8px; border: 1px solid var(--border); }
        .card-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; font-size: 13px; font-weight: 600; }
        /* 缩小 1/2 的图标 */
        .card-header svg { width: 16px; height: 16px; fill: var(--primary); }
        
        /* 播放器容器 */
        .viewer-wrap { 
            display: flex; flex-direction: column; background: #000; border: 1px solid var(--border); 
            border-radius: 8px; overflow: hidden; position: relative; width: 850px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .viewer-container { position: relative; width: 100%; height: 480px; overflow: hidden; background: #000; }
        video { position: absolute; width: 100%; height: 100%; object-fit: contain; pointer-events: none; left: 0; top: 0; }
        
        #wrapperA { position: absolute; top:0; left:0; width: 50%; height: 100%; overflow: hidden; border-right: 2px solid var(--primary); z-index: 10; pointer-events: none; }
        #compareHandle { position: absolute; top: 0; left: 50%; width: 4px; height: 100%; background: var(--primary); transform: translateX(-50%); z-index: 11; cursor: col-resize; display:flex; align-items:center; justify-content:center; }
        #compareHandle::after { content: ""; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; border: 2px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.5); }

        /* --- 控制条精细排版 --- */
        .controls-bar { 
            background: var(--panel); padding: 0 15px; height: 48px; 
            display: flex; align-items: center; gap: 15px; border-top: 1px solid var(--border); z-index: 20; 
        }
        
        /* 中间进度区 */
        .progress-container { display: flex; align-items: center; gap: 12px; flex-grow: 1; }
        #progressBar { flex-grow: 1; accent-color: var(--primary); cursor: pointer; height: 4px; }
        #timeDisplay { font-family: monospace; font-size: 12px; min-width: 45px; color: #94a3b8; }

        /* 右侧功能区 */
        .right-controls { display: flex; align-items: center; gap: 15px; }
        .vol-container { display: flex; align-items: center; gap: 8px; }
        #volBar { width: 60px; accent-color: var(--primary); cursor: pointer; }

        /* --- 全屏特供样式 --- */
        .viewer-wrap:fullscreen { width: 100vw !important; height: 100vh !important; border: none; border-radius: 0; }
        .viewer-wrap:fullscreen .viewer-container { flex-grow: 1; height: 100% !important; }
        .viewer-wrap:fullscreen .controls-bar { 
            height: 80px; padding: 0 40px; gap: 30px; 
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); 
        }
        .viewer-wrap:fullscreen .right-controls { gap: 30px; }
        .viewer-wrap:fullscreen .icon-btn svg { width: 22px; height: 22px; }
        .viewer-wrap:fullscreen #volBar { width: 100px; }
        .viewer-wrap:fullscreen #timeDisplay { font-size: 14px; }

        /* 通用输入框与按钮 */
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        input[type="text"] { background: var(--input-bg); border: 1px solid var(--border); color: var(--text); padding: 6px; border-radius: 4px; flex-grow: 1; font-size: 11px; }
        .btn-text { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 11px; cursor: pointer; }
        .stats-row { display: flex; gap: 4px; margin-top: 8px; }
        .stat-tag { font-size: 9px; background: rgba(255, 255, 255, 0.05); padding: 2px 6px; border-radius: 4px; color: #94a3b8; border: 1px solid var(--border); }
        .resize-drag { position: absolute; right: 0; bottom: 0; width: 12px; height: 12px; cursor: nwse-resize; z-index: 25; background: linear-gradient(135deg, transparent 50%, var(--primary) 50%); }
    </style>
</head>
<body>

<div class="top-nav">
    <div class="nav-tools">
        <div class="lang-switcher">
            <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
            <button class="lang-btn" id="btn-cn" onclick="setLang('cn')">中</button>
        </div>
        <button class="icon-btn" onclick="toggleTheme()"><svg viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z"/></svg></button>
    </div>
    <div style="display:flex; gap:8px;">
        <button class="btn-text" id="ui-reset" style="background:#475569" onclick="location.reload()">RESET</button>
        <button class="btn-text" style="background:var(--accent)" id="ui-share" onclick="copyShareUrl()">SHARE URL</button>
    </div>
</div>

<div class="grid">
    <div class="card">
        <div class="card-header">
            <svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
            <span id="ui-titleA">Base (Original)</span>
        </div>
        <div class="input-group">
            <input type="file" id="fileA" onchange="handleSource('A', 'file')">
            <div style="display:flex; gap:5px;"><input type="text" id="urlA" placeholder="URL"><button class="btn-text" id="ui-loadA" onclick="handleSource('A', 'url')">LOAD</button></div>
        </div>
        <div id="infoA" class="stats-row"></div>
    </div>
    <div class="card">
        <div class="card-header">
            <svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
            <span id="ui-titleB">Comparison (Upscaled)</span>
        </div>
        <div class="input-group">
            <input type="file" id="fileB" onchange="handleSource('B', 'file')">
            <div style="display:flex; gap:5px;"><input type="text" id="urlB" placeholder="URL"><button class="btn-text" id="ui-loadB" onclick="handleSource('B', 'url')">LOAD</button><button class="btn-text" style="background:#f59e0b" id="ui-sync" onclick="loadBoth()">SYNC LOAD</button></div>
        </div>
        <div id="infoB" class="stats-row"></div>
    </div>
</div>

<div class="viewer-wrap" id="mainPlayer">
    <div class="viewer-container" id="viewer">
        <video id="videoB" loop preload="auto"></video>
        <div id="wrapperA"><video id="videoA" loop preload="auto" muted></video></div>
        <div id="compareHandle"></div>
        <div class="resize-drag"></div>
    </div>
    <div class="controls-bar">
        <button class="icon-btn" onclick="togglePlay()" id="playBtn" style="border:none; background:transparent;">
            <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>

        <div class="progress-container">
            <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1">
            <span id="timeDisplay">0.0s</span>
        </div>

        <div class="right-controls">
            <div class="vol-container">
                <button class="icon-btn" onclick="toggleMute()" id="muteBtn" style="border:none; background:transparent;">
                    <svg id="vol-icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
                </button>
                <input type="range" id="volBar" min="0" max="1" step="0.05" value="1">
            </div>
            <button class="icon-btn" onclick="toggleLoop()" id="modeBtn" style="border:none; background:transparent;">
                <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
            </button>
            <button class="icon-btn" onclick="toggleFullscreen()" style="border:none; background:transparent;">
                <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm12-7h-3V5h5v5h-2V7zM5 10V5h5v2H7v3H5zm14 4v3h-3v2h5v-5h-2z"/></svg>
            </button>
        </div>
    </div>
</div>

<script>
    /* 核心逻辑：保持 v1.22 的高稳定性 */
    const vA = document.getElementById('videoA'), vB = document.getElementById('videoB');
    const viewer = document.getElementById('viewer'), playerWrap = document.getElementById('mainPlayer');
    const progBar = document.getElementById('progressBar'), volBar = document.getElementById('volBar');
    const handleEl = document.getElementById('compareHandle'), wrapA = document.getElementById('wrapperA');

    const i18n = {
        en: { titleA: "Base (Original)", titleB: "Comparison (Upscaled)", load: "LOAD", sync: "SYNC LOAD", reset: "RESET", share: "SHARE URL", res: "Res", dur: "Dur", fps: "FPS", size: "Size", copied: "URL Copied!" },
        cn: { titleA: "基础画面 (原始)", titleB: "对比画面 (超分)", load: "加载", sync: "同步加载", reset: "重置", share: "分享链接", res: "分辨率", dur: "时长", fps: "帧率", size: "大小", copied: "链接已复制!" }
    };

    let currentLang = 'en';
    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.id === 'btn-' + lang));
        document.getElementById('ui-titleA').innerText = i18n[lang].titleA;
        document.getElementById('ui-titleB').innerText = i18n[lang].titleB;
        document.getElementById('ui-loadA').innerText = i18n[lang].load;
        document.getElementById('ui-loadB').innerText = i18n[lang].load;
        document.getElementById('ui-sync').innerText = i18n[lang].sync;
        document.getElementById('ui-reset').innerText = i18n[lang].reset;
        document.getElementById('ui-share').innerText = i18n[lang].share;
        if(vA.videoWidth > 0) refreshInfo('A');
    }

    function toggleTheme() {
        const t = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', t);
    }

    const metaData = { A: { size: "N/A" }, B: { size: "N/A" } };
    function refreshInfo(type) {
        const v = (type === 'A') ? vA : vB;
        document.getElementById('info' + type).innerHTML = `
            <div class="stat-tag">${i18n[currentLang].res}: ${v.videoWidth}x${v.videoHeight}</div>
            <div class="stat-tag">${i18n[currentLang].dur}: ${v.duration.toFixed(1)}s</div>
            <div class="stat-tag">${i18n[currentLang].fps}: ${v.videoHeight >= 2160 ? 60 : 30}</div>
            <div class="stat-tag">${i18n[currentLang].size}: ${metaData[type].size}</div>
        `;
    }

    async function handleSource(type, mode) {
        const video = (type === 'A') ? vA : vB;
        let urlInput = document.getElementById('url' + type).value;
        if (mode === 'file') {
            const file = document.getElementById('file' + type).files[0];
            if (!file) return;
            video.src = URL.createObjectURL(file);
            metaData[type].size = (file.size / (1024 * 1024)).toFixed(2) + " MB";
        } else {
            if (!urlInput) return;
            video.src = urlInput;
            metaData[type].size = "Remote";
        }
        video.onloadedmetadata = () => refreshInfo(type);
    }

    function togglePlay() { vB.paused ? vB.play() : vB.pause(); }
    vB.onplay = () => { vA.play(); document.getElementById('play-icon').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'; };
    vB.onpause = () => { vA.pause(); document.getElementById('play-icon').innerHTML = '<path d="M8 5v14l11-7z"/>'; };
    
    function toggleLoop() { vB.loop = vA.loop = !vB.loop; document.getElementById('modeBtn').style.color = vB.loop ? 'var(--accent)' : 'var(--text)'; }
    volBar.oninput = () => { vB.volume = volBar.value; };
    function toggleMute() { vB.muted = !vB.muted; }

    const resizeObserver = new ResizeObserver(() => { vA.style.width = viewer.clientWidth + 'px'; });
    resizeObserver.observe(viewer);

    vB.onseeking = () => vA.currentTime = vB.currentTime;
    vB.ontimeupdate = () => {
        if (Math.abs(vA.currentTime - vB.currentTime) > 0.1) vA.currentTime = vB.currentTime;
        progBar.value = (vB.currentTime / vB.duration) * 100 || 0;
        document.getElementById('timeDisplay').innerText = vB.currentTime.toFixed(1) + 's';
    };
    progBar.oninput = () => { vB.currentTime = vA.currentTime = (progBar.value / 100) * vB.duration; };

    let isDragging = false;
    const moveHandle = e => {
        if (!isDragging) return;
        const rect = viewer.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        let x = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
        handleEl.style.left = x + '%'; wrapA.style.width = x + '%';
    };
    handleEl.onmousedown = () => isDragging = true;
    window.onmouseup = () => isDragging = false;
    window.onmousemove = moveHandle;

    function toggleFullscreen() {
        if (!document.fullscreenElement) playerWrap.requestFullscreen();
        else document.exitFullscreen();
    }
    function loadBoth() { handleSource('A', 'url'); handleSource('B', 'url'); }
    function copyShareUrl() {
        const u = new URL(window.location.href.split('?')[0]);
        u.searchParams.set('vA', document.getElementById('urlA').value);
        u.searchParams.set('vB', document.getElementById('urlB').value);
        navigator.clipboard.writeText(u.href).then(() => alert(i18n[currentLang].copied));
    }

    window.onload = () => {
        const p = new URLSearchParams(window.location.search);
        if (p.get('vA')) { document.getElementById('urlA').value = p.get('vA'); handleSource('A', 'url'); }
        if (p.get('vB')) { document.getElementById('urlB').value = p.get('vB'); handleSource('B', 'url'); }
        setLang('en');
    };
</script>
</body>
</html>
