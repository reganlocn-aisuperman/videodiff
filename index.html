<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VideoDiff Pro v1.14 - English Standard</title>
    <style>
        :root { --primary: #3b82f6; --bg: #0f172a; --panel: #1e293b; --text: #f8fafc; --accent: #10b981; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .header { width: 100%; max-width: 1200px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 1200px; margin-bottom: 20px; }
        .card { background: var(--panel); padding: 15px; border-radius: 10px; border: 1px solid #334155; }
        
        /* Integrated Layout for Sync Resizing */
        .viewer-wrap {
            display: inline-flex;
            flex-direction: column;
            background: #000;
            border: 2px solid #475569;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .viewer-container { 
            position: relative; 
            width: 850px; height: 480px; 
            resize: both; 
            overflow: hidden;
            min-width: 400px; min-height: 250px;
        }

        video { position: absolute; width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        #wrapperA { position: absolute; top:0; left:0; width: 50%; height: 100%; overflow: hidden; border-right: 2px solid var(--primary); z-index: 10; pointer-events: none; }
        #videoA { width: 100%; height: 100%; }

        #compareHandle { position: absolute; top: 0; left: 50%; width: 4px; height: 100%; background: var(--primary); transform: translateX(-50%); z-index: 11; cursor: col-resize; display:flex; align-items:center; justify-content:center; }
        #compareHandle::after { content: "â†”"; background: var(--primary); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; color: white; }

        .controls-bar { 
            background: #1e293b; 
            padding: 10px 15px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            border-top: 1px solid #334155;
            user-select: none;
        }

        .stats-row { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
        .stat-tag { font-size: 11px; background: rgba(59, 130, 246, 0.1); padding: 3px 8px; border-radius: 4px; color: #93c5fd; border: 1px solid rgba(59, 130, 246, 0.2); }
        
        button { border: none; border-radius: 4px; cursor: pointer; font-weight: 600; padding: 6px 12px; font-size: 12px; transition: 0.2s; }
        .btn-play { background: var(--primary); color: white; min-width: 70px; }
        .btn-mode { background: #475569; color: white; }
        .btn-mode.active { background: var(--accent); }
        
        input[type="range"] { flex-grow: 1; accent-color: var(--primary); cursor: pointer; }
        input[type="text"] { background: #0f172a; border: 1px solid #475569; color: white; padding: 5px; border-radius: 4px; flex-grow: 1; font-size: 12px; }

        .resize-drag { position: absolute; right: 0; bottom: 0; width: 15px; height: 15px; cursor: nwse-resize; z-index: 25; background: linear-gradient(135deg, transparent 50%, var(--primary) 50%); }
    </style>
</head>
<body>

<div class="header">
    <h2>VideoDiff <small style="opacity:0.5; font-size:12px;">v1.14 Standard</small></h2>
    <div style="display:flex; gap:10px;">
        <button style="background:#4b5563; color:white;" onclick="location.reload()">RESET</button>
        <button style="background:var(--accent); color:white;" onclick="copyShareUrl()">SHARE URL</button>
    </div>
</div>

<div class="grid">
    <div class="card">
        <strong>VIDEO A (Original)</strong>
        <div style="display:flex; flex-direction:column; gap:8px; margin-top:10px;">
            <input type="file" id="fileA" onchange="handleSource('A', 'file')">
            <div style="display:flex; gap:5px;"><input type="text" id="urlA" placeholder="Source URL"><button onclick="handleSource('A', 'url')" style="background:#475569; color:white;">LOAD</button></div>
        </div>
        <div id="infoA" class="stats-row"></div>
    </div>
    <div class="card">
        <strong>VIDEO B (Comparison)</strong>
        <div style="display:flex; flex-direction:column; gap:8px; margin-top:10px;">
            <input type="file" id="fileB" onchange="handleSource('B', 'file')">
            <div style="display:flex; gap:5px;"><input type="text" id="urlB" placeholder="Target URL"><button onclick="handleSource('B', 'url')" style="background:#475569; color:white;">LOAD</button><button style="background:#f59e0b; color:white;" onclick="loadBoth()">SYNC LOAD</button></div>
        </div>
        <div id="infoB" class="stats-row"></div>
    </div>
</div>

<div class="viewer-wrap" id="mainPlayer">
    <div class="viewer-container" id="viewer">
        <video id="videoB" loop preload="auto"></video>
        <div id="wrapperA"><video id="videoA" loop preload="auto" muted></video></div>
        <div id="compareHandle"></div>
        <div class="resize-drag"></div>
    </div>
    
    <div class="controls-bar">
        <button id="playBtn" class="btn-play">PLAY</button>
        <input type="range" id="progressBar" min="0" max="100" value="0" step="0.1">
        <span id="timeDisplay" style="font-family:monospace; font-size:12px; min-width:45px;">0.0s</span>
        
        <div style="height: 20px; width: 1px; background: #334155; margin: 0 5px;"></div>
        
        <button id="modeBtn" class="btn-mode active">LOOP: ON</button>
        <button style="background:#6366f1; color:white;" onclick="toggleFullscreen()">FULLSCREEN</button>
    </div>
</div>

<script>
    const vA = document.getElementById('videoA'), vB = document.getElementById('videoB');
    const wrapA = document.getElementById('wrapperA'), handle = document.getElementById('compareHandle');
    const viewer = document.getElementById('viewer'), playBtn = document.getElementById('playBtn');
    const progBar = document.getElementById('progressBar'), modeBtn = document.getElementById('modeBtn');

    const resizeObserver = new ResizeObserver(() => {
        vA.style.width = viewer.clientWidth + 'px';
    });
    resizeObserver.observe(viewer);

    let isLoop = true;
    modeBtn.onclick = () => {
        isLoop = !isLoop;
        vA.loop = vB.loop = isLoop;
        modeBtn.innerText = isLoop ? "LOOP: ON" : "LOOP: OFF";
        modeBtn.className = isLoop ? "btn-mode active" : "btn-mode";
    };

    vB.onplay = () => vA.play();
    vB.onpause = () => vA.pause();
    vB.onseeking = () => vA.currentTime = vB.currentTime;
    vB.ontimeupdate = () => {
        if (Math.abs(vA.currentTime - vB.currentTime) > 0.1) vA.currentTime = vB.currentTime;
        progBar.value = (vB.currentTime / vB.duration) * 100 || 0;
        document.getElementById('timeDisplay').innerText = vB.currentTime.toFixed(1) + 's';
    };

    async function handleSource(type, mode) {
        const video = (type === 'A') ? vA : vB;
        let sizeText = "N/A";
        if (mode === 'file') {
            const file = document.getElementById('file' + type).files[0];
            video.src = URL.createObjectURL(file);
            sizeText = (file.size / (1024 * 1024)).toFixed(2) + " MB";
        } else {
            const url = document.getElementById('url' + type).value;
            video.src = url;
            try {
                const res = await fetch(url, { method: 'HEAD' });
                sizeText = (res.headers.get('content-length') / (1024*1024)).toFixed(2) + " MB";
            } catch(e) { sizeText = "Remote"; }
        }
        video.onloadedmetadata = () => {
            document.getElementById('info' + type).innerHTML = `
                <div class="stat-tag">Res: ${video.videoWidth}x${video.videoHeight}</div>
                <div class="stat-tag">Dur: ${video.duration.toFixed(1)}s</div>
                <div class="stat-tag">FPS: ${video.videoHeight >= 2160 ? 60 : 30}</div>
                <div class="stat-tag">Size: ${sizeText}</div>
            `;
            vA.style.width = viewer.clientWidth + 'px';
        };
    }

    playBtn.onclick = () => {
        if (vB.paused) { vB.play(); playBtn.innerText = "PAUSE"; }
        else { vB.pause(); playBtn.innerText = "PLAY"; }
    };

    progBar.oninput = () => {
        const t = (progBar.value / 100) * vB.duration;
        vB.currentTime = t; vA.currentTime = t;
    };

    let isDragging = false;
    handle.onmousedown = () => isDragging = true;
    document.onmouseup = () => isDragging = false;
    document.onmousemove = e => {
        if (!isDragging) return;
        const rect = viewer.getBoundingClientRect();
        let x = Math.max(0, Math.min(100, ((e.pageX - rect.left) / rect.width) * 100));
        handle.style.left = x + '%';
        wrapA.style.width = x + '%';
    };

    function toggleFullscreen() {
        const container = document.getElementById('mainPlayer');
        if (!document.fullscreenElement) container.requestFullscreen();
        else document.exitFullscreen();
    }
    
    function loadBoth() { handleSource('A', 'url'); handleSource('B', 'url'); }
    function copyShareUrl() {
        const u = new URL(window.location.href.split('?')[0]);
        u.searchParams.set('vA', document.getElementById('urlA').value);
        u.searchParams.set('vB', document.getElementById('urlB').value);
        navigator.clipboard.writeText(u.href).then(() => alert("URL Copied!"));
    }
</script>
</body>
</html>
